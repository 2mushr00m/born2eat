openapi: 3.0.3
info:
  title: Born2Eat API
  version: 1.0.0
  description: |
    Born2Eat 백엔드 API 문서입니다.
    - Success: { success: true } 또는 { success: true, result: ... }
    - Error:   { success: false, code, message }
    - Auth:    세션 쿠키 기반 (cookieAuth)
servers:
  - url: http://localhost:8080
    description: Local
tags:
  - name: Auth
  - name: Me
  - name: Restaurants
  - name: Reviews
  - name: Inquiries
  - name: Admin
paths:
  /auths/signup:
    post:
      tags:
        - Auth
      summary: 회원가입
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: 회원가입 payload (상세는 추후 확정)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/Internal'
  /auths/login:
    post:
      tags:
        - Auth
      summary: 로그인
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: 로그인 payload (상세는 추후 확정)
      responses:
        '200':
          description: OK (Set-Cookie)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/Internal'
  /auths/logout:
    post:
      tags:
        - Auth
      summary: 로그아웃
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOnly'
        '500':
          $ref: '#/components/responses/Internal'
  /inquiries:
    post:
      tags:
        - Inquiries
      summary: 문의하기 (파일 업로드)
      description: uploaders.inquiry (multipart/form-data)
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              description: 문의 등록 폼(필드 상세는 추후 확정)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/Internal'
  /me:
    get:
      tags:
        - Me
      summary: 내 정보
      security:
        - cookieAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/Internal'
    patch:
      tags:
        - Me
      summary: 내 정보 수정 (프로필 업로드)
      description: uploaders.profile (multipart/form-data)
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              description: 프로필 수정 폼(필드 상세는 추후 확정)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/Internal'
    delete:
      tags:
        - Me
      summary: 회원탈퇴
      security:
        - cookieAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOnly'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/Internal'
  /me/password:
    patch:
      tags:
        - Me
      summary: 비밀번호 수정
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: 비밀번호 변경 payload(상세는 추후 확정)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOnly'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/Internal'
  /me/inquiries:
    get:
      tags:
        - Me
      summary: 내 문의 목록
      security:
        - cookieAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/Internal'
  /me/inquiries/{inquiryId}:
    get:
      tags:
        - Me
      summary: 내 문의 상세보기
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
  /me/reviews:
    get:
      tags:
        - Me
      summary: 내 리뷰 목록
      security:
        - cookieAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '500':
          $ref: '#/components/responses/Internal'
  /restaurants:
    get:
      tags:
        - Restaurants
      summary: 음식점 목록
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '500':
          $ref: '#/components/responses/Internal'
  /restaurants/{restaurantId}:
    get:
      tags:
        - Restaurants
      summary: 음식점 상세보기
      parameters:
        - in: path
          name: restaurantId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
  /restaurants/{restaurantId}/reviews:
    get:
      tags:
        - Restaurants
      summary: 해당 음식점의 리뷰보기
      parameters:
        - in: path
          name: restaurantId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
    post:
      tags:
        - Restaurants
      summary: 해당 음식점에 리뷰쓰기
      description: requireAuth + blockSuspendedUser
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: restaurantId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: 리뷰 작성 payload(상세는 추후 확정)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
  /reviews/{reviewId}:
    patch:
      tags:
        - Reviews
      summary: 사용자가 자신의 리뷰를 수정
      description: |
        리뷰를 부분 수정합니다. (태그는 예외적으로 전체 변경)

        > _Content-Type:_  
        > 업로드가 없다면 _application/json_  
        > 업로드가 있다면 _multipart/form-data_

        보내지 않는 필드는 변경되지 않습니다.  
        로그인 필요 + 정지된 사용자는 사용 불가.  
        백엔드에서 세션쿠키로 사용자를 확인하고 로그인 여부를 판단하므로, 리뷰 작성폼은 누구에게나 보이도록 해도 됩니다.

        <br/>

        사진은 이하의 photosPatch / 업로드 규칙을 따릅니다.

        1. 기존 사진 삭제/캡션 변경 (JSON 문자열)

        photosPatch로 전달.  
        삭제: {"id":102,"delete":true}  
        캡션 변경: {"id":101,"caption":"새 캡션"}  
        캡션 삭제: {"id":101,"caption":null}

        <br/>

        2. 새 사진 업로드(추가/교체)

        photos, photoIds, captions 한 세트.  
        photoIds를 ''로 넣으면 새 사진 "추가"  
        photoIds를 id로 넣으면 해당 사진 "교체"  
        상세한 방법은 이하 예시를 참고하세요.

        <br/>

        ---

        ### 프론트 FormData 예시

        <pre>
        fd.append('content', '수정 내용');  // 리뷰
        fd.append('tags', 'tagA'); // 태그
        fd.append('tags', 'tagB');
        fd.append('tags', 'tagC');
        </pre>

        <pre>
        // 기존 사진 삭제/캡션 변경
        fd.append('photosPatch', JSON.stringify([
          { id: 101, delete: true },
          { id: 102, caption: '캡션 변경' },
        ]));
        </pre>

        <pre>
        // 기존 사진 변경
        fd.append('photos', fileA);
        fd.append('photoIds', '101');
        fd.append('captions', '사진 변경');
        </pre>

        <pre>
        // 신규 사진 추가
        fd.append('photos', fileB);
        fd.append('photoIds', '');
        fd.append('captions', '');
        </pre>
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: reviewId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                rating:
                  type: number
                  minimum: 0
                  maximum: 5
                  description: 평점(선택).
                content:
                  type: string
                  description: 리뷰 내용(선택).
                tags:
                  oneOf:
                    - type: array
                      items:
                        type: string
                    - type: string
                      description: CSV 허용 (ex. tagA,tagB 문자열)
                  description: |
                    tagCode 배열 또는 CSV 문자열.
                    보내면 전체 교체(빈값이면 전체 삭제).
                photosPatch:
                  type: string
                  description: JSON 문자열. ex) [{"id":101,"delete":true}, {"id":102,"caption":"캡션 변경"}]
                photos:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: 업로드 파일들. fieldname=photos
                photoIds:
                  type: array
                  items:
                    type: string
                  description: 업로드 photos[]와 한 세트. 값 있으면 교체, 빈값이면 신규 추가.
                captions:
                  type: array
                  items:
                    type: string
                  description: 업로드 photos[]와 한 세트. 해당 사진 캡션(옵션).
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
    delete:
      tags:
        - Reviews
      summary: 리뷰 삭제
      description: /reviews prefix에 requireAuth
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: reviewId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOnly'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
  /admin/inquiries:
    get:
      tags:
        - Admin
      summary: 문의 목록
      security:
        - cookieAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/Internal'
  /admin/inquiries/{inquiryId}:
    get:
      tags:
        - Admin
      summary: 문의 상세보기
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
    patch:
      tags:
        - Admin
      summary: 문의 답변
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: inquiryId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: 문의 답변 payload(상세는 추후 확정)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
  /admin/restaurants:
    get:
      tags:
        - Admin
      summary: 음식점 목록
      security:
        - cookieAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/Internal'
    post:
      tags:
        - Admin
      summary: 음식점 생성
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: 음식점 생성 payload(상세는 추후 확정)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/Internal'
  /admin/restaurants/{restaurantId}:
    get:
      tags:
        - Admin
      summary: 음식점 상세보기
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: restaurantId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
    patch:
      tags:
        - Admin
      summary: 음식점 수정
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: restaurantId
          required: true
          schema:
            type: integer
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: 음식점 수정 payload(상세는 추후 확정)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
    delete:
      tags:
        - Admin
      summary: 음식점 삭제
      security:
        - cookieAuth: []
      parameters:
        - in: path
          name: restaurantId
          required: true
          schema:
            type: integer
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOnly'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '404':
          $ref: '#/components/responses/NotFound'
        '500':
          $ref: '#/components/responses/Internal'
  /admin/reviews:
    get:
      tags:
        - Admin
      summary: 리뷰 목록
      security:
        - cookieAuth: []
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessResult'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/Internal'
    delete:
      tags:
        - Admin
      summary: 리뷰 숨기기
      description: hard delete 대신 is_visible=0 처리
      security:
        - cookieAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              description: 숨김 처리 대상(상세는 추후 확정)
      responses:
        '200':
          description: OK
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/SuccessOnly'
        '400':
          $ref: '#/components/responses/BadRequest'
        '401':
          $ref: '#/components/responses/Unauthorized'
        '403':
          $ref: '#/components/responses/Forbidden'
        '500':
          $ref: '#/components/responses/Internal'
components:
  securitySchemes:
    cookieAuth:
      type: apiKey
      in: cookie
      name: sid
      description: |
        세션 쿠키 기반 인증입니다.
        실제 쿠키 이름은 .env(SESSION_COOKIE_NAME)로 바뀔 수 있으므로,
        운영에서 sid가 아니라면 이 값을 프로젝트 설정에 맞게 수정하세요.
  schemas:
    SuccessResult:
      type: object
      required:
        - success
        - result
      properties:
        success:
          type: boolean
          example: true
        result:
          description: API별 결과 payload
          nullable: true
    ErrorResponse:
      type: object
      required:
        - success
        - code
        - message
      properties:
        success:
          type: boolean
          example: false
        code:
          type: string
          example: UNAUTHORIZED
        message:
          type: string
          example: 로그인이 필요합니다.
    SuccessOnly:
      type: object
      required:
        - success
      properties:
        success:
          type: boolean
          example: true
  responses:
    BadRequest:
      description: BAD_REQUEST / VALIDATION
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Internal:
      description: INTERNAL / DB / EXTERNAL_API
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Unauthorized:
      description: UNAUTHORIZED
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    NotFound:
      description: NOT_FOUND
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Forbidden:
      description: FORBIDDEN
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    Conflict:
      description: CONFLICT
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
    TooManyRequests:
      description: TOO_MANY_REQUESTS
      content:
        application/json:
          schema:
            $ref: '#/components/schemas/ErrorResponse'
